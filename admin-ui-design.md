# Claude Code Client 管理者UI設計

## 1. 管理者機能の要件整理

### 1.1 管理対象
1. **ユーザー管理**: ユーザー登録・削除・権限設定
2. **Claude Code 設定**: API キー・SDK設定・バージョン管理
3. **システム設定**: サーバー設定・データベース・セキュリティ
4. **セッション管理**: アクティブセッション監視・強制終了
5. **Worktree管理**: Git Worktree監視・リソース管理・制限設定
6. **通知・Webhook管理**: 全体通知設定・Webhook エンドポイント管理
7. **ログ・監視**: システムログ・パフォーマンス監視・エラー追跡
8. **バックアップ・復旧**: データバックアップ・システム復旧

### 1.2 管理者画面一覧
1. **管理者ダッシュボード** (`/admin`) - システム概要・統計
2. **ユーザー管理** (`/admin/users`) - ユーザー一覧・編集・権限設定
3. **Claude Code設定** (`/admin/claude-config`) - API設定・SDK設定
4. **システム設定** (`/admin/system`) - サーバー・DB・セキュリティ設定
5. **セッション監視** (`/admin/sessions`) - アクティブセッション・リソース監視
6. **Worktree管理** (`/admin/worktrees`) - Git Worktree監視・制限設定
7. **通知管理** (`/admin/notifications`) - 通知設定・Webhook管理
8. **ログ・監視** (`/admin/logs`) - システムログ・エラーログ・パフォーマンス
9. **バックアップ管理** (`/admin/backup`) - バックアップ作成・復旧
10. **設定インポート/エクスポート** (`/admin/config-transfer`) - 設定の一括管理

### 1.3 権限レベル
- **Super Admin**: 全機能アクセス可能
- **System Admin**: システム設定・監視（ユーザー管理除く）
- **User Admin**: ユーザー管理・セッション監視のみ
- **Read Only Admin**: 閲覧専用

## 2. 管理者画面のワイヤーフレーム設計

### 2.1 管理者ダッシュボード
```
┌─────────────────────────────────────────────────────────────────────────────┐
│ Claude Code Client Admin                     [設定] [ログアウト] [Super Admin]│
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  🏠 管理者ダッシュボード                                                      │
│                                                                             │
│  📊 システム概要                                                             │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │ 📈 リアルタイム統計                                                      │ │
│  │ ┌─────────────┬─────────────┬─────────────┬─────────────┐                │ │
│  │ │ 👥 総ユーザー数  │ 🟢 アクティブ   │ 💾 ディスク使用量 │ 🔄 稼働時間      │                │ │
│  │ │     127      │    45      │    67%     │   15日 3時間  │                │ │
│  │ └─────────────┴─────────────┴─────────────┴─────────────┘                │ │
│  │                                                                         │ │
│  │ ┌─────────────┬─────────────┬─────────────┬─────────────┐                │ │
│  │ │ 🖥️ CPU使用率   │ 🧠 メモリ使用率  │ 🌿 Worktree数   │ ⚠️ エラー件数     │                │ │
│  │ │     45%      │    62%     │    156     │     8       │                │ │
│  │ └─────────────┴─────────────┴─────────────┴─────────────┘                │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  🚨 アラート・通知                                                            │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │ ⚠️ WARNING: ディスク使用量が70%を超えています (15:30)                     │ │
│  │ 🔴 ERROR: ユーザー'user123'のセッションでClaude API エラー (15:25)         │ │
│  │ 🟡 INFO: 新規ユーザー登録: 'newuser@example.com' (15:20)                 │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  📋 クイックアクション                                                         │
│  [👥 ユーザー管理] [🖥️ セッション監視] [📊 システムログ] [⚙️ Claude設定]       │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤ 
│ サイドメニュー:                                                              │ 
│ 🏠 ダッシュボード                                                            │ 
│ 👥 ユーザー管理                                                              │ 
│ 🤖 Claude Code設定                                                           │ 
│ ⚙️ システム設定                                                              │ 
│ 📺 セッション監視                                                            │ 
│ 🌿 Worktree管理                                                             │ 
│ 🔔 通知管理                                                                  │ 
│ 📋 ログ・監視                                                                │ 
│ 💾 バックアップ                                                              │ 
└─────────────────────────────────────────────────────────────────────────────┘ 
```

### 2.2 ユーザー管理画面
```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 👥 ユーザー管理                                             [+ 新規ユーザー]  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  🔍 検索・フィルタ                                                            │
│  [検索: ___________] [状態: すべて▼] [権限: すべて▼] [ソート: 登録日▼]         │
│                                                                             │
│  📊 ユーザー統計                                                             │
│  合計: 127名 | アクティブ: 89名 | 今日の新規: 3名 | 管理者: 5名              │
│                                                                             │
│  📋 ユーザー一覧                                                             │
│  ┌─┬────────────┬──────────────┬──────┬──────────┬─────────┬────────┐     │
│  │□│ ユーザー名    │ メールアドレス    │ 権限  │ 状態      │ 最終ログイン │ 操作    │     │
│  ├─┼────────────┼──────────────┼──────┼──────────┼─────────┼────────┤     │
│  │□│ admin        │ admin@local     │ 管理者 │ 🟢 アクティブ │ 2分前      │ [編集][削除]│     │
│  │□│ user123      │ user@email.com  │ 一般  │ 🟢 オンライン │ 5分前      │ [編集][削除]│     │
│  │□│ developer    │ dev@comp.com    │ 一般  │ 🔴 オフライン │ 2時間前    │ [編集][削除]│     │
│  │□│ testuser     │ test@email.com  │ 一般  │ ⚠️ 制限中    │ 1日前      │ [編集][削除]│     │
│  └─┴────────────┴──────────────┴──────┴──────────┴─────────┴────────┘     │
│                                                                             │
│  [選択されたユーザーを一括削除] [CSV エクスポート] [権限一括変更]              │
│                                                                             │
│  📄 ページング: [1] [2] [3] ... [12] [次へ]  表示件数: [50▼]                │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.3 Claude Code設定画面
```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 🤖 Claude Code 設定                                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  🔑 API 設定                                                                │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │ Anthropic API Key:                                                      │ │
│  │ [sk-ant-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx] [テスト] [更新]                │ │
│  │                                                                         │ │
│  │ API エンドポイント:                                                      │ │
│  │ [https://api.anthropic.com] [デフォルトに戻す]                           │ │
│  │                                                                         │ │
│  │ リクエスト制限:                                                          │ │
│  │ 1分あたり: [100] リクエスト | 1日あたり: [10000] リクエスト              │ │
│  │                                                                         │ │
│  │ ✅ API接続テスト: 正常 (最終テスト: 2024-06-24 15:30)                   │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  ⚙️ Claude Code SDK 設定                                                    │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │ SDK バージョン: [v1.2.3] [アップデート確認] [手動インストール]           │ │
│  │                                                                         │ │
│  │ デフォルト設定:                                                          │ │
│  │ □ 自動セッション保存 (30分間隔)                                          │ │
│  │ □ エラー自動復旧を有効にする                                            │ │
│  │ □ デバッグログを有効にする                                              │ │
│  │                                                                         │ │
│  │ セッションタイムアウト: [8] 時間                                         │ │
│  │ 最大並行セッション数: [50] セッション                                    │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  🔧 詳細設定                                                                │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │ Docker設定:                                                              │ │
│  │ ベースイメージ: [python:3.11-slim] [カスタムイメージを追加]              │ │
│  │ メモリ制限: [2GB] | CPU制限: [1.0] コア                                 │ │
│  │                                                                         │ │
│  │ セキュリティ設定:                                                        │ │
│  │ □ コンテナ間通信を制限                                                  │ │
│  │ □ ファイルシステム書き込み制限                                          │ │
│  │ □ ネットワークアクセス制限                                              │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  [設定を保存] [設定をリセット] [設定をエクスポート]                          │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.4 セッション監視画面
```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📺 セッション監視                                          🔄 自動更新: ON   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  📊 リアルタイム統計                                                         │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐                  │
│  │ 🟢 アクティブ   │ 💻 総セッション  │ 🔥 高負荷セッション │ ⚠️ エラーセッション  │                  │
│  │     15       │     127      │      3        │       2        │                  │
│  └─────────────┴─────────────┴─────────────┴─────────────┘                  │
│                                                                             │
│  🔍 フィルタ・検索                                                            │
│  [ユーザー: _____] [状態: すべて▼] [プロジェクト: _____] [期間: 今日▼]        │
│                                                                             │
│  📋 アクティブセッション一覧                                                  │
│  ┌─┬────────┬─────────────┬─────────┬──────┬──────┬──────┬────────┐         │
│  │□│ ユーザー │ プロジェクト   │ 状態     │ CPU  │メモリ │時間  │ 操作    │         │
│  ├─┼────────┼─────────────┼─────────┼──────┼──────┼──────┼────────┤         │
│  │□│ user123 │ web-app      │🟢 実行中  │ 45%  │ 1.2GB│ 2h   │[表示][終了]│         │
│  │□│ dev456  │ api-server   │🔥 高負荷  │ 89%  │ 2.1GB│ 4h   │[表示][終了]│         │
│  │□│ test789 │ mobile-app   │⚠️ エラー  │ 12%  │ 0.8GB│ 1h   │[表示][終了]│         │
│  │□│ admin   │ system-tools │🟢 実行中  │ 23%  │ 0.5GB│ 30m  │[表示][終了]│         │
│  └─┴────────┴─────────────┴─────────┴──────┴──────┴──────┴────────┘         │
│                                                                             │
│  💻 リソース使用状況                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │ 📊 CPU使用率:  [████████████████████████░░░░░░░░] 65%                   │ │
│  │ 🧠 メモリ:     [████████████████████░░░░░░░░░░░░] 58% (12.5GB / 24GB)   │ │
│  │ 💾 ディスク:   [██████████░░░░░░░░░░░░░░░░░░░░░░] 28% (140GB / 500GB)   │ │
│  │ 🌐 ネットワーク: ↑ 125 MB/s  ↓ 87 MB/s                                │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  [選択セッションを一括終了] [全セッション強制終了] [リソースアラート設定]      │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.5 Worktree管理画面
```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 🌿 Worktree管理                                          🔄 自動更新: ON   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  📊 Worktree統計                                                            │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐                  │
│  │ 🌿 総Worktree数 │ 🟢 アクティブ   │ 💾 使用ディスク量 │ ⚠️ 制限超過        │                  │
│  │     156      │     89      │   12.5GB   │      3        │                  │
│  └─────────────┴─────────────┴─────────────┴─────────────┘                  │
│                                                                             │
│  🔍 フィルタ・検索                                                            │
│  [ユーザー: _____] [リポジトリ: _____] [ブランチ: _____] [状態: すべて▼]       │
│                                                                             │
│  📋 Worktree一覧                                                            │
│  ┌─┬────────┬─────────────┬─────────┬──────┬──────┬──────┬────────┐         │
│  │□│ ユーザー │ リポジトリ   │ ブランチ │ 状態  │サイズ │セッション│ 操作    │         │
│  ├─┼────────┼─────────────┼─────────┼──────┼──────┼──────┼────────┤         │
│  │□│ user123│ project-A   │ main    │🟢 アクティブ│ 1.2GB│ あり   │[表示][削除]│         │
│  │□│ user123│ project-A   │ feature │🟢 アクティブ│ 1.5GB│ あり   │[表示][削除]│         │
│  │□│ dev456 │ api-server  │ hotfix  │⚠️ 制限超過│ 3.2GB│ あり   │[表示][削除]│         │
│  │□│ test789│ mobile-app  │ dev     │🔴 エラー  │ 0.8GB│ なし   │[表示][削除]│         │
│  └─┴────────┴─────────────┴─────────┴──────┴──────┴──────┴────────┘         │
│                                                                             │
│  ⚙️ Worktree制限設定                                                        │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │ ユーザー別制限:                                                          │ │
│  │ 最大Worktree数: [10] 個/ユーザー | 最大サイズ: [5] GB/Worktree          │ │
│  │                                                                         │ │
│  │ システム全体制限:                                                        │ │
│  │ 総Worktree数: [200] 個 | 総使用量上限: [100] GB                        │ │
│  │                                                                         │ │
│  │ 自動クリーンアップ:                                                      │ │
│  │ □ 非アクティブWorktreeを自動削除 ([30] 日後)                            │ │
│  │ □ セッション終了時にWorktreeを削除                                      │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  [選択Worktreeを削除] [制限超過を解除] [一括クリーンアップ] [設定を保存]      │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.6 システムログ・監視画面
```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📋 システムログ・監視                                     [ログ設定] [エクスポート]│
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  📊 ログ統計                                                                │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐                  │
│  │ 📝 総ログ件数   │ ⚠️ 警告        │ 🔴 エラー      │ 🔥 クリティカル   │                  │
│  │   15,234     │     234      │     45       │      8        │                  │
│  └─────────────┴─────────────┴─────────────┴─────────────┘                  │
│                                                                             │
│  🔍 ログフィルタ                                                             │
│  [レベル: すべて▼] [モジュール: すべて▼] [期間: 今日▼] [検索: _________]      │
│                                                                             │
│  📋 ログ一覧                                                                │
│  ┌─────────┬──────┬─────────┬─────────────────────────────────────────────┐ │
│  │ 時刻     │レベル │ モジュール│ メッセージ                                  │ │
│  ├─────────┼──────┼─────────┼─────────────────────────────────────────────┤ │
│  │15:30:45 │🔴 ERROR│ API     │Claude API timeout - user: user123         │ │
│  │15:30:12 │⚠️ WARN │ Auth    │Multiple failed login attempts: 192.168.1.100│ │
│  │15:29:55 │💙 INFO │ Session │New session created - user: newuser         │ │
│  │15:29:20 │💙 INFO │ System  │Memory usage: 65% - within normal range     │ │
│  │15:28:45 │🔥 CRITICAL│Docker│Container out of memory - force restart     │ │
│  └─────────┴──────┴─────────┴─────────────────────────────────────────────┘ │
│                                                                             │
│  💹 パフォーマンスグラフ                                                      │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │ 📈 過去24時間のシステム負荷                                               │ │
│  │    100%│                                                               │ │
│  │     80%│    ┌─┐                                                         │ │
│  │     60%│ ┌──┘ └─┐        ┌──┐                                          │ │  
│  │     40%│─┘      └────────┘  └──────────────────                        │ │
│  │     20%│                                                               │ │
│  │      0%└───────────────────────────────────────────────────────────────│ │
│  │        0h  6h  12h  18h  24h                                           │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  [アラート設定] [ログ自動削除設定] [パフォーマンスレポート生成]                │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.6 システム設定画面
```
┌─────────────────────────────────────────────────────────────────────────────┐
│ ⚙️ システム設定                                                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  🖥️ サーバー設定                                                            │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │ ホスト名: [claude-code-server.local] [変更]                              │ │
│  │ ポート: [8080] | HTTPS: [有効 ✓] | HTTP/2: [有効 ✓]                    │ │
│  │                                                                         │ │
│  │ SSL証明書:                                                               │ │
│  │ 証明書ファイル: [/etc/ssl/server.crt] [アップロード]                     │ │
│  │ 秘密鍵ファイル: [/etc/ssl/server.key] [アップロード]                     │ │
│  │ 有効期限: 2025-06-24 (残り342日) [更新]                                 │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  🗄️ データベース設定                                                        │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │ DB接続文字列: [postgresql://user:***@localhost:5432/claude_db]           │ │
│  │ 接続プール: 最小 [5] | 最大 [50] | タイムアウト [30秒]                   │ │
│  │                                                                         │ │
│  │ バックアップ設定:                                                        │ │
│  │ □ 自動バックアップを有効 (毎日 03:00)                                   │ │
│  │ 保存期間: [30] 日 | バックアップ先: [/backup/db/]                       │ │
│  │                                                                         │ │
│  │ ✅ DB接続テスト: 正常 (応答時間: 12ms)                                   │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  🔐 セキュリティ設定                                                        │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │ パスワードポリシー:                                                      │ │
│  │ □ 最小8文字 □ 大文字を含む □ 数字を含む □ 特殊文字を含む                 │ │
│  │ パスワード有効期限: [90] 日                                              │ │
│  │                                                                         │ │
│  │ ログイン制限:                                                            │ │
│  │ 失敗回数上限: [5] 回 | ロック時間: [30] 分                              │ │
│  │ セッション有効期限: [24] 時間                                            │ │
│  │                                                                         │ │
│  │ IP制限:                                                                  │ │
│  │ [許可IP一覧] [192.168.1.0/24] [10.0.0.0/8] [+追加]                     │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  🌐 ネットワーク設定                                                        │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │ CORS設定: [https://admin.example.com] [+追加]                           │ │
│  │ リバースプロキシ: [Nginx] | 設定ファイル: [/etc/nginx/claude.conf]       │ │
│  │ CDN: [無効] | キャッシュ有効期限: [3600] 秒                              │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  [設定を保存] [設定をテスト] [デフォルトに戻す] [設定をバックアップ]          │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 3. 権限管理とセキュリティ考慮

### 3.1 管理者権限レベル
```
Super Admin (最高権限)
├── システム設定の変更
├── Claude Code API設定
├── セキュリティ設定
├── バックアップ・復旧
└── 他の管理者権限の変更

System Admin (システム管理)
├── システム監視・ログ確認
├── セッション管理・強制終了
├── パフォーマンス監視
└── 設定の閲覧（変更不可）

User Admin (ユーザー管理)
├── ユーザー追加・削除・編集
├── ユーザー権限設定
├── セッション監視
└── ユーザー関連ログ確認

Read Only Admin (読み取り専用)
├── すべての設定・ログの閲覧
├── 統計情報の確認
├── レポート生成
└── エクスポート機能
```

### 3.2 セキュリティ対策
- **二要素認証**: 管理者アカウントは2FA必須
- **監査ログ**: すべての管理操作をログ記録
- **セッション管理**: 管理者セッションは短時間で無効化
- **IP制限**: 管理画面へのアクセスIP制限
- **暗号化**: 設定情報の暗号化保存

## 4. 次のステップ

1. **詳細設計**: 各画面のデータモデル・API設計
2. **プロトタイプ作成**: 管理者用のHTMLプロトタイプ
3. **権限制御実装**: ロールベースアクセス制御（RBAC）
4. **監査機能**: 操作ログ・変更履歴の実装
5. **自動化機能**: 定期バックアップ・ヘルスチェック等